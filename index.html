<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroClima PY - Predicción Climática para Agricultores</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2E7D32;
            --accent-color: #8BC34A;
            --dark-color: #1B5E20;
            --light-color: #C8E6C9;
            --text-dark: #212121;
            --text-light: #f5f5f5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text-dark);
        }

        .hero {
            height: 100vh;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('logogrande.png') no-repeat center center/cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 0 20px;
        }

        .hero h1 {
            font-size: 5rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .hero p {
            font-size: 1.5rem;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .btn {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn:hover {
            background: var(--dark-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
            padding: 20px;
        }

        nav ul li {
            margin: 0 15px;
        }

        nav ul li a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }

        nav ul li a:hover {
            color: var(--primary-color);
        }

        section {
            padding: 80px 0;
        }

        h2 {
            font-size: 2.5rem;
            margin-bottom: 40px;
            color: var(--dark-color);
            text-align: center;
        }

        .weather-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .weather-controls button {
            padding: 10px 20px;
            background-color: var(--light-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .weather-controls button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .weather-controls button:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .unit-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .unit-controls select {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
        }

        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            height: 300px; /* Altura reducida significativamente */
        }

        .chart-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .weather-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .weather-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
        }

        .weather-card h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .weather-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .weather-card .description {
            color: #666;
        }

        .recommendations {
            background-color: var(--light-color);
            padding: 30px;
            border-radius: 10px;
            margin-top: 40px;
        }

        .recommendations h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .recommendation-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .recommendation-card p {
            color: #666;
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            overflow-y: auto;
            transition: right 0.3s ease;
            z-index: 1001;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .sidebar-content {
            margin-top: 20px;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-section h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .sidebar-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 15px 10px;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            cursor: pointer;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            z-index: 1000;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
        }

        /* Nuevo panel de desarrolladores */
        #desarrolladores {
            background-color: var(--light-color);
            padding: 50px;
            border-radius: 15px;
            margin-top: 60px;
            text-align: center;
        }

        #desarrolladores h2 {
            color: var(--dark-color);
            margin-bottom: 30px;
        }

        #panel-desarrolladores {
            min-height: 200px;
            border: 2px dashed var(--accent-color);
            border-radius: 10px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.7);
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 3rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            nav ul {
                flex-wrap: wrap;
            }
            
            nav ul li {
                margin: 5px 10px;
            }
            
            .sidebar {
                width: 100%;
                right: -100%;
            }
            
            .sidebar.active {
                right: 0;
            }
            
            #desarrolladores {
                padding: 30px 15px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="#prediccion">Predicción</a></li>
            <li><a href="#graficos">Gráficos</a></li>
            <li><a href="#recomendaciones">Recomendaciones</a></li>
            <li><a href="#informacion">Información</a></li>
            <li><a href="#desarrolladores">Desarrolladores</a></li>
        </ul>
    </nav>

    <div class="hero">
        <h1>AgroClima PY</h1>
        <p>Inteligencia Artificial para predecir el clima y optimizar la agricultura en Paraguay</p>
        <a href="#prediccion" class="btn">Ver Predicción</a>
    </div>

    <div class="sidebar-toggle" id="sidebarToggle">Información</div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-close" id="sidebarClose">&times;</div>
        <h3>Información Agrícola</h3>
        <div class="sidebar-content">
            <div class="sidebar-section">
                <h4>Datos Actuales</h4>
                <p id="currentDate">Fecha: Cargando...</p>
                <p id="currentLocation">Ubicación: Asunción, Paraguay</p>
                <p id="currentWeather">Clima actual: Cargando...</p>
            </div>
            <div class="sidebar-section">
                <h4>Notas Agrícolas</h4>
                <textarea id="agriculturalNotes" placeholder="Escribe aquí tus notas agrícolas..." rows="5" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;"></textarea>
                <button id="saveNotes" class="btn" style="padding: 8px 15px; margin-top: 10px;">Guardar Notas</button>
            </div>
            <div class="sidebar-section">
                <h4>Recordatorios</h4>
                <ul id="remindersList" style="list-style: none;">
                    <li style="margin-bottom: 10px;">
                        <input type="text" placeholder="Nuevo recordatorio" style="width: 70%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                        <button class="btn" style="padding: 5px 10px; margin-left: 5px;">+</button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <section id="prediccion">
            <h2>Predicción Climática</h2>
            <div class="weather-controls">
                <button class="active" data-days="5">5 Días</button>
                <button data-days="14">2 Semanas</button>
                <button data-days="30">1 Mes</button>
                <button data-days="90">3 Meses</button>
            </div>
            
            <div class="weather-cards" id="weatherCards">
                <!-- Weather cards will be dynamically inserted here -->
            </div>
        </section>

        <section id="graficos">
            <h2>Análisis Gráfico</h2>
            
            <div class="unit-controls">
                <select id="tempUnit">
                    <option value="celsius">°C</option>
                    <option value="fahrenheit">°F</option>
                </select>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Temperatura</h3>
                <canvas id="tempChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Humedad</h3>
                <canvas id="humidityChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Precipitación</h3>
                <canvas id="precipitationChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Presión Atmosférica</h3>
                <canvas id="pressureChart"></canvas>
            </div>
        </section>

        <section id="recomendaciones">
            <h2>Recomendaciones Agrícolas</h2>
            
            <div class="recommendations">
                <h3>Basado en las condiciones climáticas actuales y futuras</h3>
                
                <div class="recommendations-grid">
                    <div class="recommendation-card">
                        <h4>Cultivos Recomendados</h4>
                        <p id="recommendedCrops">Cargando recomendaciones...</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4>Época de Siembra</h4>
                        <p id="plantingSeason">Cargando información...</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4>Enfermedades a Vigilar</h4>
                        <p id="diseasesToWatch">Cargando información...</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4>Consejos de Riego</h4>
                        <p id="irrigationTips">Cargando información...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="informacion">
            <h2>Información Climática de Asunción</h2>
            
            <div class="chart-container">
                <h3 class="chart-title">Clima Promedio</h3>
                <p>Asunción tiene un clima subtropical húmedo con veranos calurosos e inviernos suaves. La temperatura media anual es de aproximadamente 23°C, con precipitaciones distribuidas durante todo el año pero más intensas entre octubre y abril.</p>
                
                <div style="margin-top: 20px;">
                    <h4>Estaciones Agrícolas:</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Verano (Diciembre-Febrero):</strong> Calor intenso y alta humedad, ideal para cultivos tropicales.</li>
                        <li><strong>Otoño (Marzo-Mayo):</strong> Temperaturas más moderadas, buena época para siembra.</li>
                        <li><strong>Invierno (Junio-Agosto):</strong> Templado, pocas heladas, adecuado para cultivos de invierno.</li>
                        <li><strong>Primavera (Septiembre-Noviembre):</strong> Aumento de temperaturas y lluvias, preparación para cultivos de verano.</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Nuevo panel de desarrolladores -->
        <section id="desarrolladores">
            <h2>Desarrolladores</h2>
            <div id="panel-desarrolladores">
                <!-- Aquí puedes agregar información manualmente -->
            </div>
        </section>
    </div>

    <footer>
        <p>AgroClima PY &copy; 2025 - Predicción climática inteligente para agricultores paraguayos</p>
        <p style="margin-top: 10px;">Datos proporcionados por OpenWeather API y análisis de IA</p>
    </footer>

    <script>
        // API Key for OpenWeather - Replace with your actual API key
        const API_KEY = '38e63c3a0501533e79c57e789ae2b52d';
        const CITY = 'Asuncion,PY';
        
        // DOM Elements
        const weatherControls = document.querySelectorAll('.weather-controls button');
        const weatherCardsContainer = document.getElementById('weatherCards');
        const tempUnitSelect = document.getElementById('tempUnit');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarClose = document.getElementById('sidebarClose');
        const agriculturalNotes = document.getElementById('agriculturalNotes');
        const saveNotesBtn = document.getElementById('saveNotes');
        
        // Charts
        let tempChart, humidityChart, precipitationChart, pressureChart;
        
        // Current selected days
        let selectedDays = 5;
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date in sidebar
            const now = new Date();
            document.getElementById('currentDate').textContent = `Fecha: ${now.toLocaleDateString('es-PY')}`;
            
            // Load saved notes from localStorage
            if(localStorage.getItem('agriculturalNotes')) {
                agriculturalNotes.value = localStorage.getItem('agriculturalNotes');
            }
            
            // Fetch initial weather data
            fetchWeatherData(selectedDays);
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize charts with empty data
            initializeCharts();
        });
        
        function setupEventListeners() {
            // Weather period controls
            weatherControls.forEach(button => {
                button.addEventListener('click', function() {
                    weatherControls.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    selectedDays = parseInt(this.dataset.days);
                    fetchWeatherData(selectedDays);
                });
            });
            
            // Temperature unit change
            tempUnitSelect.addEventListener('change', function() {
                updateChartsWithCurrentData();
            });
            
            // Sidebar toggle
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });
            
            sidebarClose.addEventListener('click', function() {
                sidebar.classList.remove('active');
            });
            
            // Save notes
            saveNotesBtn.addEventListener('click', function() {
                localStorage.setItem('agriculturalNotes', agriculturalNotes.value);
                alert('Notas guardadas correctamente');
            });
        }
        
        function fetchWeatherData(days) {
            // First get current weather
            fetch(`https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric&lang=es`)
                .then(response => response.json())
                .then(currentData => {
                    // Update current weather in sidebar
                    document.getElementById('currentWeather').textContent = 
                        `Clima actual: ${currentData.weather[0].description}, ${Math.round(currentData.main.temp)}°C`;
                    
                    // Then get forecast - OpenWeather provides 5-day forecast for free
                    // For longer periods, we'll simulate with historical patterns and AI prediction
                    fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${CITY}&appid=${API_KEY}&units=metric&lang=es`)
                        .then(response => response.json())
                        .then(forecastData => {
                            // Process the data
                            const processedData = processWeatherData(currentData, forecastData, days);
                            
                            // Update UI
                            updateWeatherCards(processedData);
                            updateCharts(processedData);
                            updateRecommendations(processedData);
                        })
                        .catch(error => {
                            console.error('Error fetching forecast data:', error);
                            // Fallback to simulated data if API fails
                            const simulatedData = simulateWeatherData(days);
                            updateWeatherCards(simulatedData);
                            updateCharts(simulatedData);
                            updateRecommendations(simulatedData);
                        });
                })
                .catch(error => {
                    console.error('Error fetching current weather:', error);
                    // Fallback to simulated data if API fails
                    document.getElementById('currentWeather').textContent = 'Clima actual: Datos no disponibles';
                    const simulatedData = simulateWeatherData(days);
                    updateWeatherCards(simulatedData);
                    updateCharts(simulatedData);
                    updateRecommendations(simulatedData);
                });
        }
        
        function processWeatherData(currentData, forecastData, days) {
            // This function processes the raw API data into our format
            const processedData = [];
            const now = new Date();
            
            // Add current weather
            processedData.push({
                date: now,
                day: 'Hoy',
                temp: currentData.main.temp,
                feels_like: currentData.main.feels_like,
                humidity: currentData.main.humidity,
                pressure: currentData.main.pressure,
                precipitation: currentData.rain ? currentData.rain['1h'] || 0 : 0,
                description: currentData.weather[0].description,
                icon: currentData.weather[0].icon
            });
            
            // Process forecast data for the next 5 days (API provides 3-hour intervals)
            if(forecastData && forecastData.list) {
                const dailyData = {};
                
                forecastData.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dateStr = date.toLocaleDateString('es-PY');
                    
                    if(!dailyData[dateStr]) {
                        dailyData[dateStr] = {
                            date: date,
                            day: getDayName(date),
                            temps: [],
                            feels_like: [],
                            humidity: [],
                            pressure: [],
                            precipitation: 0,
                            descriptions: [],
                            icons: []
                        };
                    }
                    
                    dailyData[dateStr].temps.push(item.main.temp);
                    dailyData[dateStr].feels_like.push(item.main.feels_like);
                    dailyData[dateStr].humidity.push(item.main.humidity);
                    dailyData[dateStr].pressure.push(item.main.pressure);
                    
                    if(item.rain && item.rain['3h']) {
                        dailyData[dateStr].precipitation += item.rain['3h'];
                    }
                    
                    dailyData[dateStr].descriptions.push(item.weather[0].description);
                    dailyData[dateStr].icons.push(item.weather[0].icon);
                });
                
                // Calculate averages and most common values for each day
                Object.keys(dailyData).forEach(dateStr => {
                    const dayData = dailyData[dateStr];
                    
                    // Skip today (already added)
                    if(dateStr === now.toLocaleDateString('es-PY')) return;
                    
                    // Only add if we're within the requested days
                    if(processedData.length < days) {
                        processedData.push({
                            date: dayData.date,
                            day: dayData.day,
                            temp: average(dayData.temps),
                            feels_like: average(dayData.feels_like),
                            humidity: average(dayData.humidity),
                            pressure: average(dayData.pressure),
                            precipitation: dayData.precipitation,
                            description: getMostCommon(dayData.descriptions),
                            icon: getMostCommon(dayData.icons)
                        });
                    }
                });
            }
            
            // If we need more days than the API provides, simulate them
            if(days > processedData.length) {
                const remainingDays = days - processedData.length;
                const simulatedData = simulateAdditionalDays(remainingDays, processedData);
                processedData.push(...simulatedData);
            }
            
            return processedData;
        }
        
        function simulateWeatherData(days) {
            // This function generates simulated weather data for demonstration
            // when the API is not available or for periods beyond API limits
            const simulatedData = [];
            const now = new Date();
            
            // Base values for Asunción
            const baseTemp = 24; // Average temperature in °C
            const baseHumidity = 70; // Average humidity in %
            const basePressure = 1012; // Average pressure in hPa
            
            for(let i = 0; i < days; i++) {
                const date = new Date();
                date.setDate(now.getDate() + i);
                
                // Seasonal variation
                const month = date.getMonth();
                let tempVariation = 0;
                let rainProbability = 0.3;
                
                if(month >= 11 || month <= 1) { // Summer
                    tempVariation = 5 + Math.random() * 5;
                    rainProbability = 0.5;
                } else if(month >= 2 && month <= 4) { // Autumn
                    tempVariation = 2 + Math.random() * 3;
                    rainProbability = 0.4;
                } else if(month >= 5 && month <= 7) { // Winter
                    tempVariation = -2 - Math.random() * 3;
                    rainProbability = 0.2;
                } else { // Spring
                    tempVariation = 1 + Math.random() * 4;
                    rainProbability = 0.4;
                }
                
                // Daily variation
                const dailyTempVariation = (Math.random() - 0.5) * 4;
                
                // Calculate values
                const temp = baseTemp + tempVariation + dailyTempVariation;
                const humidity = baseHumidity + (Math.random() - 0.5) * 20;
                const pressure = basePressure + (Math.random() - 0.5) * 10;
                const precipitation = Math.random() < rainProbability ? (Math.random() * 15) : 0;
                
                // Determine weather description
                let description, icon;
                if(precipitation > 10) {
                    description = 'Lluvia intensa';
                    icon = '10d';
                } else if(precipitation > 5) {
                    description = 'Lluvia moderada';
                    icon = '09d';
                } else if(precipitation > 0) {
                    description = 'Lluvia ligera';
                    icon = '09d';
                } else if(temp > 30) {
                    description = 'Soleado';
                    icon = '01d';
                } else if(temp > 25) {
                    description = 'Parcialmente nublado';
                    icon = '02d';
                } else {
                    description = 'Nublado';
                    icon = '03d';
                }
                
                simulatedData.push({
                    date: date,
                    day: i === 0 ? 'Hoy' : getDayName(date),
                    temp: temp,
                    feels_like: temp - (Math.random() * 3),
                    humidity: humidity,
                    pressure: pressure,
                    precipitation: precipitation,
                    description: description,
                    icon: icon
                });
            }
            
            return simulatedData;
        }
        
        function simulateAdditionalDays(days, existingData) {
            // Simulate additional days based on existing data patterns
            const simulatedData = [];
            const lastData = existingData[existingData.length - 1];
            
            for(let i = 0; i < days; i++) {
                const date = new Date(lastData.date);
                date.setDate(date.getDate() + i + 1);
                
                // Create variation based on previous data
                const tempVariation = (Math.random() - 0.5) * 3;
                const humidityVariation = (Math.random() - 0.5) * 10;
                const pressureVariation = (Math.random() - 0.5) * 5;
                
                // Determine precipitation based on season and previous days
                const month = date.getMonth();
                let rainProbability = 0.3;
                
                if(month >= 11 || month <= 1) rainProbability = 0.5; // Summer
                else if(month >= 5 && month <= 7) rainProbability = 0.2; // Winter
                
                // Check if previous days had rain (persistence)
                const prevRainDays = existingData.slice(-3).filter(d => d.precipitation > 0).length;
                if(prevRainDays > 1) rainProbability += 0.2;
                
                const precipitation = Math.random() < rainProbability ? (Math.random() * 10) : 0;
                
                // Determine weather description
                let description, icon;
                if(precipitation > 5) {
                    description = 'Lluvia';
                    icon = '10d';
                } else if(precipitation > 0) {
                    description = 'Lluvia ligera';
                    icon = '09d';
                } else if(lastData.temp > 28) {
                    description = 'Soleado';
                    icon = '01d';
                } else {
                    description = 'Parcialmente nublado';
                    icon = '02d';
                }
                
                simulatedData.push({
                    date: date,
                    day: getDayName(date),
                    temp: lastData.temp + tempVariation,
                    feels_like: lastData.feels_like + tempVariation - (Math.random() * 2),
                    humidity: Math.max(40, Math.min(90, lastData.humidity + humidityVariation)),
                    pressure: lastData.pressure + pressureVariation,
                    precipitation: precipitation,
                    description: description,
                    icon: icon
                });
            }
            
            return simulatedData;
        }
        
        function updateWeatherCards(data) {
            weatherCardsContainer.innerHTML = '';
            
            data.forEach(day => {
                const card = document.createElement('div');
                card.className = 'weather-card';
                
                // Weather icon - using OpenWeather icons (you would need to implement this)
                const iconUrl = `https://openweathermap.org/img/wn/${day.icon}@2x.png`;
                
                card.innerHTML = `
                    <h3>${day.day}</h3>
                    <p>${day.date.toLocaleDateString('es-PY')}</p>
                    <img src="${iconUrl}" alt="${day.description}" style="width: 50px; height: 50px; margin: 10px 0;">
                    <p class="value">${Math.round(day.temp)}°C</p>
                    <p class="description">${capitalizeFirstLetter(day.description)}</p>
                    <div style="margin-top: 15px;">
                        <p><strong>Humedad:</strong> ${Math.round(day.humidity)}%</p>
                        <p><strong>Precipitación:</strong> ${day.precipitation.toFixed(1)} mm</p>
                        <p><strong>Presión:</strong> ${Math.round(day.pressure)} hPa</p>
                    </div>
                `;
                
                weatherCardsContainer.appendChild(card);
            });
        }
        
        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            };
            
            // Temperature Chart
            const tempCtx = document.getElementById('tempChart').getContext('2d');
            tempChart = new Chart(tempCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: chartOptions
            });
            
            // Humidity Chart
            const humidityCtx = document.getElementById('humidityChart').getContext('2d');
            humidityChart = new Chart(humidityCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: chartOptions
            });
            
            // Precipitation Chart
            const precipitationCtx = document.getElementById('precipitationChart').getContext('2d');
            precipitationChart = new Chart(precipitationCtx, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: chartOptions
            });
            
            // Pressure Chart
            const pressureCtx = document.getElementById('pressureChart').getContext('2d');
            pressureChart = new Chart(pressureCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: chartOptions
            });
        }
        
        function updateCharts(data) {
            const labels = data.map(day => day.day);
            const tempData = data.map(day => day.temp);
            const feelsLikeData = data.map(day => day.feels_like);
            const humidityData = data.map(day => day.humidity);
            const precipitationData = data.map(day => day.precipitation);
            const pressureData = data.map(day => day.pressure);
            
            // Update temperature chart
            tempChart.data.labels = labels;
            tempChart.data.datasets = [
                {
                    label: 'Temperatura',
                    data: tempData,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.1
                },
                {
                    label: 'Sensación Térmica',
                    data: feelsLikeData,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.1
                }
            ];
            tempChart.update();
            
            // Update humidity chart
            humidityChart.data.labels = labels;
            humidityChart.data.datasets = [
                {
                    label: 'Humedad (%)',
                    data: humidityData,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }
            ];
            humidityChart.update();
            
            // Update precipitation chart
            precipitationChart.data.labels = labels;
            precipitationChart.data.datasets = [
                {
                    label: 'Precipitación (mm)',
                    data: precipitationData,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }
            ];
            precipitationChart.update();
            
            // Update pressure chart
            pressureChart.data.labels = labels;
            pressureChart.data.datasets = [
                {
                    label: 'Presión (hPa)',
                    data: pressureData,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    tension: 0.1
                }
            ];
            pressureChart.update();
        }
        
        function updateChartsWithCurrentData() {
            // This would be called when unit changes, etc.
            // For now just re-update with current data
            updateCharts(currentWeatherData);
        }
        
        function updateRecommendations(data) {
            // This function generates agricultural recommendations based on weather data
            const avgTemp = average(data.map(day => day.temp));
            const avgHumidity = average(data.map(day => day.humidity));
            const totalPrecip = data.reduce((sum, day) => sum + day.precipitation, 0);
            const month = data[0].date.getMonth();
            
            // Determine season
            let season, plantingPeriod;
            if(month >= 11 || month <= 1) {
                season = "verano";
                plantingPeriod = "principios de otoño (febrero-marzo)";
            } else if(month >= 2 && month <= 4) {
                season = "otoño";
                plantingPeriod = "invierno (mayo-julio)";
            } else if(month >= 5 && month <= 7) {
                season = "invierno";
                plantingPeriod = "primavera (agosto-septiembre)";
            } else {
                season = "primavera";
                plantingPeriod = "verano (octubre-diciembre)";
            }
            
            // Generate crop recommendations
            let recommendedCrops = [];
            if(avgTemp > 25) {
                recommendedCrops.push("mandioca", "batata", "maíz", "poroto", "sandía", "melón");
            } else if(avgTemp > 18) {
                recommendedCrops.push("soja", "trigo", "canola", "cebolla", "zanahoria", "lechuga");
            } else {
                recommendedCrops.push("trigo", "avena", "cebada", "arveja", "col", "brócoli");
            }
            
            // Adjust for precipitation
            if(totalPrecip/data.length > 5) {
                recommendedCrops = recommendedCrops.filter(crop => 
                    !["cebolla", "zanahoria"].includes(crop));
                recommendedCrops.push("arroz", "camote");
            } else if(totalPrecip/data.length < 2) {
                recommendedCrops = recommendedCrops.filter(crop => 
                    !["arroz", "sandía"].includes(crop));
            }
            
            // Generate disease warnings
            let diseases = [];
            if(avgHumidity > 75) {
                diseases.push("roya", "tizón tardío", "mildiu");
            }
            if(avgTemp > 25 && avgHumidity > 70) {
                diseases.push("antracnosis", "bacteriosis");
            }
            if(avgTemp < 20 && avgHumidity > 80) {
                diseases.push("pie negro", "fusarium");
            }
            
            // Generate irrigation tips
            let irrigationTips = "";
            if(totalPrecip/data.length > 5) {
                irrigationTips = "Las lluvias son abundantes, puede reducir el riego. Asegúrese de buen drenaje para evitar encharcamientos.";
            } else if(totalPrecip/data.length > 2) {
                irrigationTips = "Las lluvias son suficientes para la mayoría de cultivos. Riegue solo en ausencia de lluvia por más de 3 días.";
            } else {
                irrigationTips = "Las condiciones son secas. Riegue regularmente, preferiblemente en las primeras horas de la mañana.";
            }
            
            // Update DOM
            document.getElementById('recommendedCrops').textContent = 
                recommendedCrops.join(", ") + ". Buenas opciones para el " + season + " en Asunción.";
            
            document.getElementById('plantingSeason').textContent = 
                "La próxima época ideal de siembra es " + plantingPeriod + 
                " basado en el clima actual y pronósticos.";
            
            document.getElementById('diseasesToWatch').textContent = 
                diseases.length > 0 ? 
                "Alta probabilidad de " + diseases.join(", ") + ". Monitorar cultivos y aplicar preventivos." : 
                "Bajo riesgo de enfermedades. Mantenga prácticas preventivas básicas.";
            
            document.getElementById('irrigationTips').textContent = irrigationTips;
        }
        
        // Helper functions
        function average(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }
        
        function getMostCommon(arr) {
            return arr.sort((a, b) =>
                arr.filter(v => v === a).length - arr.filter(v => v === b).length
            ).pop();
        }
        
        function getDayName(date) {
            const days = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            return days[date.getDay()];
        }
        
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // Store current weather data for unit changes, etc.
        let currentWeatherData = [];
    </script>
</body>
</html>
